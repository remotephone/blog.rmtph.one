<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CyberDefenders.org - macOS Spotlight - Forensics Walkthrough | Notepad+++</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="CyberDefenders.org - macOS Spotlight - Forensics Walkthrough" /><meta name="author" content="remotephone" /><meta property="og:locale" content="en_US" /><meta name="description" content="Another go at CyberDefenders.org" /><meta property="og:description" content="Another go at CyberDefenders.org" /><link rel="canonical" href="https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/" /><meta property="og:url" content="https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/" /><meta property="og:site_name" content="Notepad+++" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-16T00:22:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CyberDefenders.org - macOS Spotlight - Forensics Walkthrough" /><meta name="twitter:site" content="@remotephone" /><meta name="twitter:creator" content="@remotephone" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"remotephone"},"description":"Another go at CyberDefenders.org","@type":"BlogPosting","headline":"CyberDefenders.org - macOS Spotlight - Forensics Walkthrough","url":"https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/","dateModified":"2021-04-16T00:22:00-05:00","datePublished":"2021-04-16T00:22:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@remotephone"><meta name="twitter:title" content="CyberDefenders.org - macOS Spotlight - Forensics Walkthrough"><meta name="twitter:description" content="My personal blog, mostly security focused."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://remotephone.github.io/images/avatar.jpg"><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/images/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Notepad+++</a></div><div class="site-subtitle font-italic">Break it, fix it, write it down.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/remotephone" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/remotephone" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['remotephone','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>CyberDefenders.org - macOS Spotlight - Forensics Walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CyberDefenders.org - macOS Spotlight - Forensics Walkthrough</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 16, 2021, 12:22 AM -0500" > Apr 16, 2021 <i class="unloaded">2021-04-16T00:22:00-05:00</i> </span> by <span class="author"> remotephone </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jul 8, 2022, 10:17 PM -0500" > Jul 8 <i class="unloaded">2022-07-08T22:17:59-05:00</i> </span></div></div><div class="post-content"><h1 id="another-go-at-cyberdefendersorg">Another go at CyberDefenders.org</h1><p>Having another go at a <a href="https://cyberdefenders.org/">CyberDefenders</a> challenge, this one about macOS image forensics. You can find a link to the challenge <a href="https://cyberdefenders.org/labs/34">here</a>.</p><h2 id="environment">Environment</h2><p>I did this largely on my Windows workstation. I used Autopsy to analyze the image. I used Windows Subsystem for Linux 2 to install mac_apt on. I cannot overstate how convenient it is to have very transparent access to Linux tools via my Windows workstation. I will boot into Linux every now and then if I need to, but I find I need to less and less as WSL gets better and better, especially once WSL2 came out.</p><p>I set this up and installed stuff one night, worked on this over 2 nights and ran into some issues. I’ll call out where it was night 2 and I had some time to think about the issues. Taking time off during work like this does me wonders because I can approach problems with a fresh mind later.</p><p>The big difference on night 2 is that I installed apfs-fuse and used it to mount the drive and examine it manually. Somethings didn’t work through Autopsy and I don’t know why, but mounting the image and browsing let me access some files I couldn’t access via Autopsy. Keep in mind this is not necessarily forensically sound unless you mount read only.</p><h2 id="some-notes">Some notes</h2><p>Autopsy failed to complete the download a couple of times, might have been my network having hiccups. Chrome’s download resume feature came in handy, same for the forenics image.</p><p>I recommend you do this on an SSD. The image is 27gb, you’ll need to extract it before you can work on it, and faster the disk the better. 500gb NVME drives are as cheap as 60 bucks now which is insane considering the speed an value, so if you have space for one, do it.</p><p>I’m using a Ryzen 5 2600 and 16gb of ram, this took a long time. Even with a speedy drive, expanding the files took 10-15 minutes and once expanded, it took another 50 minutes to get the image loaded into Autopsy. Just be ready to keep busy as things get set up.</p><p>This is my command line history for installing and configuring apfs-fuse, there were a few minor snags I ran into that got answered by browsing issues (see references, but this is what worked for me).</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> /tmp/mount
<span class="nb">sudo </span>apt <span class="nb">install </span>ewf-tools
ewfmount
ewfmount Desktop/c18-spotlight/Spotlight/FruitBook.E01 /tmp/mount
<span class="nb">cd</span> /tmp/mount
<span class="nb">mkdir</span> /tmp/mountpoint
<span class="nb">sudo </span>apt <span class="nb">install </span>sleuthkit
<span class="nb">sudo </span>apt <span class="nb">install </span>fuse libfuse3-dev bzip2 libbz2-dev cmake git libattr1-dev zlib1g-dev
<span class="nb">sudo </span>apt <span class="nb">install </span>clang
<span class="nb">cd
</span>git clone https://github.com/sgan81/apfs-fuse.git
<span class="nb">cd </span>apfs-fuse
git submodule init
git submodule update
<span class="nb">mkdir </span>build
<span class="nb">cd </span>build
<span class="nb">ls
</span>cmake ..
make
apfs-fuse
<span class="nb">ls</span>
./apfs-fuse /tmp/mount/ewf1 /tmp/mountpoint
<span class="nb">sudo </span>apt <span class="nb">install </span>fuse3 <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install </span>libfuse3-dev
./apfs-fuse /tmp/mount/ewf1 /tmp/mountpoint
</pre></table></code></div></div><p>I watched Godzilla (2014) while doing this. This movie is excellent and I love it.</p><h2 id="question-1-what-version-of-macos-is-running-on-this-image">Question 1: What version of macOS is running on this image?</h2><p>I figured the BASICINFO plugin from mac_apt would give me this, but since I was installing it and loading the image into autopsy at the same time and autopsy finished slightly first, I was able to find the image info in Autopsy. Click into Results &gt; Extracted Content &gt; Operating System Information, Click SystemVersion.plist under the Listing tab on the right, and the at the bottom right, select the Text tab and you can read the plist file and pretty easily see we’re running version 10.15.</p><h2 id="question-2-what-copetitive-advatge-did-hansel-lie-about-in-the-file-anotherexamplejpg-two-words">Question 2: What “copetitive advatge” did Hansel lie about in the file AnotherExample.jpg? (two words)</h2><p>I got zero points for this one and I don’t know what’s wrong. I used all the hints to get the answer</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>computer@computer: /mnt/c/Users/computer/Desktop/c18-spotlight/1/Export
<span class="nv">$ </span>strings AnotherExample.jpg                                                                 <span class="o">[</span>22:50:08]
<span class="o">(</span>mac_apt<span class="o">)</span>  
computer@computer: /mnt/c/Users/computer/Desktop/c18-spotlight/1/Export
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-aslh</span>                                                                                                                                                                                                                    <span class="o">[</span>22:50:11]
total 0
0 drwxrwxrwx 1 computer computer 4.0K Apr 14 22:44 <span class="nb">.</span>
0 drwxrwxrwx 1 computer computer 4.0K Apr 14 22:48 ..
0 <span class="nt">-rwxrwxrwx</span> 1 computer computer    0 Apr 14 22:44 AnotherExample.jpg
<span class="o">(</span>mac_apt<span class="o">)</span>  
computer@computer: /mnt/c/Users/computer/Desktop/c18-spotlight/1/Export
<span class="nv">$ </span>                                                                            
</pre></table></code></div></div><p>I tried extracting the file. You can find the file in vol5 &gt; APFS Pool &gt; vol0 &gt; Users &gt; Shared &gt; AnotherExample.jpg. It was easy enough to find but I tried extracting the file and got an empty file. I tried to view the file in the hex editor and nothing there either. The file has a file size listed but it just didn’t work. Who knows what’s up here.</p><h4 id="night-2">Night 2</h4><p>I ended up mounting the drive in WSL2 and was able to browse to the file, strings it, and get the answer very easily. This is my command history and the image was mounted to /tmp/mountpoint</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /tmp/mountpoint/root
<span class="nb">ls
cd </span>Users/Shared/
<span class="nb">ls
</span>file AnotherExample.jpg
<span class="nb">cp </span>AnotherExample.jpg /mnt/c/Users/computer/Desktop
<span class="nb">cat </span>secret
strings AnotherExample.jpg
</pre></table></code></div></div><h2 id="question-3-how-many-bookmarks-are-registered-in-safari">Question 3: How many bookmarks are registered in safari?</h2><p>This file is the bookmarks file we’re looking for- “/img_FruitBook.E01/vol_vol5/APFS Pool/vol_vol0/Users/hansel.apricot/Library/Safari/Bookmarks.plist” You can see in the bottom right table of autopsy theres 13 to look through.</p><h2 id="question-4-whats-the-content-of-the-note-titled-passwords">Question 4: What’s the content of the note titled “Passwords”?</h2><p>I tried doing this through Autopsy and while I could find the Notes sqlite db and extract it, I was having trouble going through it manually with sqlite3.</p><p>I used the mac_apt plugin NOTES with this syntax.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="sb">`</span>python3 mac_apt.py E01 /mnt/c/Users/computer/Desktop/c18-spotlight/Spotlight/FruitBook.E01 <span class="nt">-o</span> /mnt/c/Users/computer/Desktop/c18-spotlight/mac_apt/ NOTES <span class="nt">-x</span><span class="sb">`</span>
</pre></table></code></div></div><p>This gave me excel formatted output which was very easy to read. The flag is “Passwords”.</p><h2 id="question-5-provide-the-mac-address-of-the-ethernet-adapter-for-this-machine">Question 5: Provide the MAC address of the ethernet adapter for this machine</h2><p>This syntax was the quickest way to grab it. Maybe it’s in autopsy, but I didn’t bother looking.</p><p><code class="language-plaintext highlighter-rouge">python3 mac_apt.py E01 /mnt/c/Users/computer/Desktop/c18-spotlight/Spotlight/FruitBook.E01 -o /mnt/c/Users/computer/Desktop/c18-spotlight/mac_apt/ NETWORKING -x</code></p><p>as mac_apt writes new files to your output folder, it numbers them intelligently by appending 01, 02 etc to each file. The flag for this one was 00:0C:29:C4:65:77 which is easy to find on the Interfaces tab of the output.</p><h2 id="question-6-name-the-data-url-of-the-quarantined-item">Question 6: Name the data URL of the quarantined item</h2><p>We can use the QUARANTINE plugin for this. The only file in the quarantine tab is <code class="language-plaintext highlighter-rouge">https://futureboy.us/stegano/encode.pl</code></p><h2 id="question-7-what-app-did-the-user-sneaky-try-to-install-via-a-dmg-file-one-word">Question 7: What app did the user “sneaky” try to install via a .dmg file? (one word)</h2><p>We can use Autopsy for this one. Find the user’s folder. All macOS user folders are under /Users an Vol5 with the APFS pool has the appropriate mapping for us. Browsing through their files we find something interesting in the Trash folder. <code class="language-plaintext highlighter-rouge">/img_FruitBook.E01/vol_vol5/APFS Pool/vol_vol0/Users/sneaky/.Trash/silenteye-0.4.1b-snowleopard.dmg</code></p><p><code class="language-plaintext highlighter-rouge">silenteye</code> is your flag. Always check the Trash.</p><h2 id="question-8-what-was-the-file-examplestegjpg-renamed-to">Question 8: What was the file ‘Examplesteg.jpg’ renamed to?</h2><p>I feel like I brute forced this one too. I don’t know if I loaded the image wrong or really have no clue what I’m doing, but I tried searching file change events and this file didn’t seem to show up. There were several thousand find, but whacha gonna do.</p><p>Ultimately, I found it by browsing <code class="language-plaintext highlighter-rouge">/img_FruitBook.E01/vol_vol5/APFS Pool/vol_vol0/Users/Shared/</code> since I knew there was action there.</p><p>If I went to the timeline, reset all filters, and added only the filter of name <code class="language-plaintext highlighter-rouge">Examplesteg.jpg</code> I got zero results. I don’t know what I’m missing here, but the fact that question gives you the first letter gives you what you need to find the answer.</p><h2 id="question-9-how-much-time-was-spent-on-mailzohocom-on-4202020">Question 9: How much time was spent on mail.zoho.com on 4/20/2020?</h2><p>Autopsy was not very useful for this.</p><p><code class="language-plaintext highlighter-rouge">$ python3 mac_apt.py E01 /mnt/c/Users/computer/Desktop/c18-spotlight/Spotlight/FruitBook.E01 -o /mnt/c/Users/computer/Desktop/c18-spotlight/mac_apt/ DOMAINS NETUSAGE SAFARI SCREENTIME -x</code></p><p>I tried to add the times from the Safari tab but didn’t get the write answer. I had to use all the hints here before I realized I had alsoc pulled the SCREENTIME function to get 20:58 for the screentime. That’s the flag.</p><h2 id="question-10-what-is-the-name-of-the-file-that-has-a-quicklook-bitmap-data-location-of-166472">Question 10: What is the name of the file that has a QuickLook bitmap data location of 166472?</h2><p>I recognized this file from the hints in the flag prompt easy, but the answer doesn’t make sense with my output. I am not certain I have a valid extraction, so I would be interested to see what the output for the correct answer is here.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://remotephone.github.io/images/macos_forensics_01.png" alt="macos file bitmap location" class="center-image" /></p><p>The flag here is <code class="language-plaintext highlighter-rouge">Get A NEW PHONE TODAY!.jpg</code></p><h2 id="question-11-whats-hanselapricots-password-hint-two-words">Question 11: What’s hansel.apricot’s password hint? (two words)</h2><p><code class="language-plaintext highlighter-rouge">$ python3 mac_apt.py E01 /mnt/c/Users/computer/Desktop/c18-spotlight/Spotlight/FruitBook.E01 -o /mnt/c/Users/computer/Desktop/c18-spotlight/mac_apt/ USERS -x</code></p><p>We can use this syntax to generate an excel sheet with user info, including the password hint. Our flag is <code class="language-plaintext highlighter-rouge">Family Opinion</code></p><h2 id="question-12-the-main-file-that-stores-hansels-imessages-had-a-few-permissions-changes-how-many-times-did-the-permissions-change">Question 12: The main file that stores Hansel’s iMessages had a few permissions changes. How many times did the permissions change?</h2><p>I actually get 5 changes here. I used the <code class="language-plaintext highlighter-rouge">FSEVENTS</code> module and exported to Excel. Filtered to the Filepath <code class="language-plaintext highlighter-rouge">Users/hansel.apricot/Library/Messages/chat.db</code> and got 5 <code class="language-plaintext highlighter-rouge">PermissionChange</code> events. I brute forced the answer and got 7 though. Not sure why. Even if we include <code class="language-plaintext highlighter-rouge">FolderCreated|PermissionChange</code> I get only 6 changes.</p><h2 id="question-13-whats-hanselapricots-password-hint-two-words">Question 13: What’s hansel.apricot’s password hint? (two words)</h2><p>This is asking for the user rsponsible for connecting USB devices. Some simple standard google searches didn’t get me anything I could use. I ended up using the hints and I got to the user usbmuxd described <a href="https://github.com/libimobiledevice/usbmuxd">here</a>. Your flag is <code class="language-plaintext highlighter-rouge">213</code>, but I feel like this is one of those things you just gotta know.</p><p>I tried the IDEVICEINFO plugin for mac_apt and got nothign useful, so there may have been another way to this answer but I didn’t find it.</p><h2 id="-everything-past-here-is-night-2-">– Everything past here is night 2. –</h2><h2 id="question-14-find-the-flag-in-the-goodexamplejpg-image-its-hidden-with-better-tools">Question 14: Find the flag in the GoodExample.jpg image. It’s hidden with better tools</h2><p>So we have the file in our mounted drive, and it says they used better tools to hide the data in the image. Stegonography is a method of hiding data inside an image without affecting the image quality. You can use <code class="language-plaintext highlighter-rouge">info</code> to get information about what’s embedded and hope you either have the password or its black.</p><div class="language-zsh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>computer@computer: /mnt/c/Users/computer/Desktop/gits/mac_apt master!
<span class="nv">$ </span>steghide info /tmp/mountpoint/root/Users/Shared/GoodExample.jpg
<span class="s2">"GoodExample.jpg"</span>:
  format: jpeg
  capacity: 7.6 KB
Try to get information about embedded data ? <span class="o">(</span>y/n<span class="o">)</span> y
Enter passphrase:
  embedded file <span class="s2">"steganopayload27635.txt"</span>:
    size: 106.0 Byte
    encrypted: rijndael-128, cbc
    compressed: <span class="nb">yes
</span>computer@computer: /mnt/c/Users/computer/Desktop/gits/mac_apt master!
<span class="nv">$ </span>steghide extract <span class="nt">-sf</span> /tmp/mountpoint/root/Users/Shared/GoodExample.jpg <span class="nt">--passphrase</span> <span class="s2">""</span>
wrote extracted data to <span class="s2">"steganopayload27635.txt"</span><span class="nb">.</span>
<span class="o">(</span>mac_apt<span class="o">)</span>
computer@computer: /mnt/c/Users/computer/Desktop/gits/mac_apt master!
<span class="nv">$ </span><span class="nb">cat </span>steganopayload27635.txt
Our latest phone will have flag&lt;helicopter&gt; blades and 6 cameras on it. No
other phone has those features!%
<span class="o">(</span>mac_apt<span class="o">)</span>
</pre></table></code></div></div><p>And our flag is <code class="language-plaintext highlighter-rouge">helicopter</code>!</p><h2 id="question-15-what-was-exactly-typed-in-the-spotlight-search-bar-on-4202020-020948">Question 15: What was exactly typed in the Spotlight search bar on 4/20/2020 02:09:48</h2><p>We can parse the spotlight database with this syntax <code class="language-plaintext highlighter-rouge">$ python3 mac_apt.py E01 /mnt/c/Users/computer/Desktop/c18-spotlight/Spotlight/FruitBook.E01 -o /mnt/c/Users/computer/Desktop/c18-spotlight/mac_apt/ SPOTLIGHTSHORTCUTS -x</code>. The SPOTLIGHTSHORTCUTS plugin shows you what was typed into the searchbar. I used a sqlite db browser, it doesn’t matter which you use, but the table with the data is SpotlightShortcuts.</p><h2 id="question-16-what-is-hanselapricots-open-directory-user-uuid">Question 16: What is hansel.apricot’s Open Directory user UUID?</h2><p>FINALLY. Using the <code class="language-plaintext highlighter-rouge">USERS</code> plugin for mac_apt again, you can get quite a bit of information about all users on the system. In the Users table of the mac_apt output, you will see the UUID for hansel.apricot, <code class="language-plaintext highlighter-rouge">5BB00259-4F58-4FDE-BC67-C2659BA0A5A4</code> and that’s our final flag.</p><h2 id="all-done">All done</h2><p>Excellent exercise again. There were a few things that I’m not sure if I did wrong or what, but I have some pretty clear takeaways about the tools. Autopsy is great, but I really don’t think there’s anything I couldn’t have done with mac_apt. I am really impressed by the quality and comprehensiveness of that tool. It’s well documented, full of useful features, and the output is incredibly easy to parse and analyze.</p><p>Knowing what I know now, I would have skipped using Autopsy entirely and just gone for mac_apt and mounting the drive. Most of the disk forensics I’ve done is in linux and this feels very close to that. APFS is kinda wacky with where stuff gets laid out, but you can poke around and find your footing pretty easily if you’re familiar with macOS.</p><p>Finally, thanks again to <a href="https://cyberdefenders.org">CyberDefenders.org</a> and <a href="https://twitter.com/champdfa">@champdfa</a> for putting this together.</p><h2 id="references">References</h2><p><a href="https://apple.stackexchange.com/questions/401556/where-are-the-safari-bookmarks-stored-on-a-computer">Macos Bookmarks Location</a> <a href="https://www.andreafortuna.org/2018/04/11/how-to-mount-an-ewf-image-file-e01-on-linux/">How to Mount an EWF image file</a> <a href="https://github.com/ydkhatri/mac_apt">mac_apt</a> <a href="https://github.com/sgan81/apfs-fuse">apfs-fuse</a> <a href="https://github.com/sgan81/apfs-fuse/issues/87">Missing Fuse3 Linux</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/lab/'>lab</a>, <a href='/categories/homelab/'>homelab</a>, <a href='/categories/forensics/'>forensics</a>, <a href='/categories/macos/'>macos</a>, <a href='/categories/workflow/'>workflow</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CyberDefenders.org - macOS Spotlight - Forensics Walkthrough - Notepad+++&url=https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CyberDefenders.org - macOS Spotlight - Forensics Walkthrough - Notepad+++&u=https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=CyberDefenders.org - macOS Spotlight - Forensics Walkthrough - Notepad+++&url=https://remotephone.github.io/posts/CyberDefenders_macos_spotlight/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/what-is-markdown/">What is Markdown anyway?</a></li><li><a href="/posts/welcome-to-jekyll/">Welcome to My Scratchpad</a></li><li><a href="/posts/reverse-shell-cheatsheet/">Reverse Shell Cheat Sheet</a></li><li><a href="/posts/practical-docker-part2/">Practical Docker for Security Admins - Part 2</a></li><li><a href="/posts/practical-docker/">Practical Docker for Security Admins - Part 1</a></li></ul></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HoneyPot-Forensics/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Dec 8, 2021 <i class="unloaded">2021-12-08T22:49:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HoneyPot Forensics</h3><div class="text-muted small"><p> A Helpful Tweet I saw this tweet and thought it would be interesting to take a look around. I will pick something specific in the evidence, take a look at it, and write about what I find. Some St...</p></div></div></a></div><div class="card"> <a href="/posts/Proxmox-Greasing-the-Wheels/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 21, 2018 <i class="unloaded">2018-08-21T11:31:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox - Greasing the Wheels</h3><div class="text-muted small"><p> I got distracted. I’ve done quite a bit of work on the incident response type lab I’ve been working on, but I also got interested in Docker and Docker Swarm. I’ve built that and it works so I figur...</p></div></div></a></div><div class="card"> <a href="/posts/Proxmox_Ansible_and_Some_Notes/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 21, 2018 <i class="unloaded">2018-08-21T11:31:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox, Ansible, And Some Notes</h3><div class="text-muted small"><p> I’ve been using Ansible a little bit now and while it has a very easy learning curve, there’s some finer points I had some trouble figuring out. I’m still not the best with it, but being barely fun...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CyberDefenders_maldoc101/" class="btn btn-outline-primary"><p>CyberDefenders.org - Maldoc101 Walkthrough</p></a> <a href="/posts/MITRE_ATT&CK_Defender/" class="btn btn-outline-primary"><p>MITRE ATT&CK Defender - My Thoughts on Training and Certification</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/remotephone">remotephone</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-158754701-1', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://remotephone.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
